{% comment %}
  Email Popup Section - Mobile First, All Requirements
  Shows on all pages except legal/terms pages. Highly configurable.
{% endcomment %}

<link rel="stylesheet" href="{{ 'newsletter.css' | asset_url }}">
<link rel="stylesheet" href="{{ 'component-newsletter.css' | asset_url }}">
<link rel="stylesheet" href="{{ 'age-verifier.css' | asset_url }}">
<link rel="stylesheet" href="{{ 'geolocation-popup.css' | asset_url }}">
<link rel="stylesheet" href="{{ 'foxify-modal-component.css' | asset_url }}">

<div id="email-popup-root" style="display:none;">
  <!-- Modal markup will be injected by JS for mobile-first, accessibility, and performance -->
</div>

<script src="{{ 'email-popup.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Email Popup",
  "settings": [
    {"type": "checkbox", "id": "enable", "label": "Enable email popup", "default": false},
    {"type": "checkbox", "id": "preview_mode", "label": "Preview mode (always show for admin)", "default": false},
    {"type": "header", "content": "Trigger Conditions"},
    {"type": "select", "id": "trigger_type", "label": "Trigger type", "options": [
      {"value": "immediate", "label": "Show immediately"},
      {"value": "delay", "label": "After delay (seconds)"},
      {"value": "scroll", "label": "On scroll %"},
      {"value": "exit_intent", "label": "On exit intent (desktop only)"}
    ], "default": "delay"},
    {"type": "range", "id": "trigger_delay", "label": "Delay (seconds)", "min": 1, "max": 60, "step": 1, "default": 5},
    {"type": "range", "id": "trigger_scroll", "label": "Scroll % to trigger", "min": 10, "max": 90, "step": 5, "default": 50},
    {"type": "checkbox", "id": "trigger_new_visitors_only", "label": "Show only to new visitors", "default": false},
    {"type": "checkbox", "id": "trigger_returning_visitors_only", "label": "Show only to returning visitors", "default": false},
    {"type": "checkbox", "id": "trigger_mobile_only", "label": "Show only on mobile", "default": false},
    {"type": "checkbox", "id": "trigger_desktop_only", "label": "Show only on desktop", "default": false},
    {"type": "textarea", "id": "exclude_urls", "label": "Exclude URLs (one per line, e.g. /policies/terms-of-service)", "default": "/policies/terms-of-service\n/policies/privacy-policy\n/policies/refund-policy"},
    {"type": "range", "id": "resurface_delay", "label": "Delay before showing again after close (hours)", "min": 1, "max": 72, "step": 1, "default": 24},
    {"type": "header", "content": "Popup Appearance"},
    {"type": "color", "id": "bg_color", "label": "Background color", "default": "#ffffff"},
    {"type": "color", "id": "text_color", "label": "Text color", "default": "#222222"},
    {"type": "color", "id": "accent_color", "label": "Accent color (button)", "default": "#007bff"},
    {"type": "color", "id": "overlay_color", "label": "Overlay color", "default": "#000000"},
    {"type": "range", "id": "overlay_opacity", "label": "Overlay opacity (%)", "min": 0, "max": 100, "step": 5, "default": 40},
    {"type": "select", "id": "font_family", "label": "Font family", "options": [
      {"value": "inherit", "label": "Inherit"},
      {"value": "sans-serif", "label": "Sans-serif"},
      {"value": "serif", "label": "Serif"},
      {"value": "monospace", "label": "Monospace"}
    ], "default": "inherit"},
    {"type": "range", "id": "border_radius", "label": "Border radius (px)", "min": 0, "max": 32, "step": 2, "default": 12},
    {"type": "range", "id": "shadow_strength", "label": "Shadow strength", "min": 0, "max": 3, "step": 1, "default": 2},
    {"type": "image_picker", "id": "popup_image", "label": "Popup image (optional)"},
    {"type": "header", "content": "Form Content"},
    {"type": "text", "id": "heading", "label": "Heading", "default": "Subscribe for exclusive offers!"},
    {"type": "richtext", "id": "description", "label": "Description", "default": "<p>Sign up to get a discount code and the latest news.</p>"},
    {"type": "text", "id": "email_placeholder", "label": "Email placeholder", "default": "Enter your email"},
    {"type": "text", "id": "submit_button", "label": "Submit button label", "default": "Subscribe"},
    {"type": "checkbox", "id": "show_agreement", "label": "Show terms & conditions checkbox", "default": false},
    {"type": "richtext", "id": "agreement_text", "label": "Agreement text", "default": "<p>I agree to the <a href=\"/policies/terms-of-service\">Terms of Service</a></p>"},
    {"type": "header", "content": "Thank You & Discount"},
    {"type": "richtext", "id": "thank_you_message", "label": "Thank you message", "default": "<p>Thank you for subscribing!</p>"},
    {"type": "checkbox", "id": "enable_discount", "label": "Show discount code after signup", "default": false},
    {"type": "text", "id": "discount_code", "label": "Discount code (if enabled)", "default": "WELCOME10"},
    {"type": "text", "id": "discount_instructions", "label": "Discount usage instructions", "default": "Copy and use this code at checkout."},
    {"type": "checkbox", "id": "show_copy_button", "label": "Show copy-to-clipboard button", "default": true},
    {"type": "header", "content": "Integration & Analytics"},
    {"type": "checkbox", "id": "integrate_shopify_customers", "label": "Add emails to Shopify customers DB", "default": true},
    {"type": "checkbox", "id": "enable_webhook", "label": "Enable webhook for third-party integration", "default": false},
    {"type": "text", "id": "webhook_url", "label": "Webhook URL", "default": "-"},
    {"type": "checkbox", "id": "enable_mailchimp", "label": "Enable Mailchimp integration", "default": false},
    {"type": "text", "id": "mailchimp_api_key", "label": "Mailchimp API Key", "default": "-"},
    {"type": "text", "id": "mailchimp_list_id", "label": "Mailchimp List ID", "default": "-"},
    {"type": "checkbox", "id": "enable_klaviyo", "label": "Enable Klaviyo integration", "default": false},
    {"type": "text", "id": "klaviyo_api_key", "label": "Klaviyo API Key", "default": "-"},
    {"type": "text", "id": "klaviyo_list_id", "label": "Klaviyo List ID", "default": "-"},
    {"type": "checkbox", "id": "fallback_storage", "label": "Enable fallback storage if integration fails", "default": true},
    {"type": "checkbox", "id": "enable_analytics", "label": "Enable popup analytics", "default": true},
    {"type": "checkbox", "id": "gdpr_compliance", "label": "Enable GDPR compliance", "default": true},
    {"type": "header", "content": "Accessibility & UX"},
    {"type": "checkbox", "id": "enable_keyboard_nav", "label": "Enable keyboard navigation", "default": true},
    {"type": "checkbox", "id": "enable_screen_reader", "label": "Enable screen reader support", "default": true},
    {"type": "text", "id": "custom_class", "label": "Custom CSS class", "default": "-"}
  ],
  "presets": [
    {"name": "Email Popup", "category": "Popups"}
  ]
}
{% endschema %} 